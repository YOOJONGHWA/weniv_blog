#### 성능 최적화

---

##### 성능 및 지연 시간 최적화 개요

- 성능이란 무엇일까?

  - 성능은 시나리와 사용용도에 따라 다르게 측정 될수 있다.

    - 빠른 응답 시스템

    - 비디오 플레이어

    - 대규모 데이터 머신 러닝

- 빠른 응답 시스템

  - 쇼핑몰에서 특정 물품을 구매하는 과정에서 의 성능의 척도는 지연시간이다.

    - 트랜잭션(물품 수량을 감소하는 로직등)을 빠르게 처리하면 할소록 지연시간이 줄어든다 그러면 당연히 응답 소속가 빨라지고 성능이 좋아진다.

- 비디오 플레이어

  - 예를들어 초당 30 프레임으로 녹화된 영화를 초당 1,000프레임으로 보여 준다면 사용자는 아무것도 볼수 없다.

  - 즉 비디오 플레이어에서의 성능 척도는 정확한 프레임 레이트가 필요하다.

- 대규모 데이터 머신 러닝

  - 쉽게 말해 시스템이 24시간동안 수집한 데이터를 사용자에게 보여준다고 하면 데이터가 많을수록 더 좋은 예측이 가능하다

  - 즉 이경우는 처리량이 성능의 척도이다.

---

1. 지연시간

   - 시간 단위로 측정

   - 작업 하나의 완료 시간으로 정의

2. 처리량

   - 일정 시간 동안 완료한 작업의 양

   - 시간 단위당 작업으로 측정

- 지연시간 과 처리량은 별개 이며 한쪽이 개선되어도 한쪽에서 영향이 없을수도 있지만 영행이 미칠수도 있다.

---

#### 지연 시간

- 멀티 스레드 프로그래밍에서 지연 시간을 어떻게 줄일수 있을까?

![alt text](/img/스레딩/image1.png)

그림 처럼 싱글 스레드로 순차적으로 완료할 수 있는 하나의 작업에서

![alt text](/img/스레딩/image3.png)

다시 위에 그림처럼 큰 작업을 여러 작업으로 나누고

![alt text](/img/스레딩/image4.png)

하위 작업들을 병렬로 실행되도록 하여 각자 다른 스레드에 스케줄링을 한다면 ? N 이 커질수록 지연 시간은 줄어들 것이다.

하지만 이는 이론적인 방식이고 아래 와 같은 상황을 이해해야 한다.

---

#### N = ?

- 작업을 원하는 만큼 하위 작업으로 나눌 수 있다면 몇 개가 되야 하나?

  - 일반적인 컴퓨터의 N은 컴퓨터의 코어 개수와 최대한 비슷해야 한다.

    - 하위 작업을 모두 병렬로 실행하면 지연 시간이 줄어들기 때문

- 운영 체제는 다른 코어로 다른 작업을 스케줄링하고

- 하나의 스레드만 추가해도 생산성이 떨어져 성능도 저하되고 지연 시간은 늘어난다.

  - 어째서 지연 시간이 늘어날까?

    - 컨텍스트 스위칭, 캐시 성능 저하, 추가 메모리 소비가 증가

---

#### N = ? 공식

- 결국 N = 코어 란 공식 모든스레드가 인터럽트 없이 하위 작업을 실행해야 최적인 공식이다.

- 즉 모든 스레드가 Running 상태이여야 한다.

- 요즘 컴퓨터들은 거의 하이퍼스레딩을 사용

  - 코어 하나가 스레드 두 개를 동시에 실행할 수 있다.

#### 비용 문제

    - 하나의 작업을 여러개로 나누고 병렬 실행하여 결과를 종합하는데 드는 비용은 감수 해야 한다.

---
